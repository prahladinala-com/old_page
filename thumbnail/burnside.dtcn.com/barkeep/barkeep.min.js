'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var _Barkeep=function(){function a(){var b=this,c=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,a);this;this.default_args={container_sel:'h-bartender',pint_bar_class:'h-pint',pint_pos_class:'m-pint-pos',pint_wrap_class:'m-pint-wrap',fixed_class:'is-fixed',inactive_class:'is-dead',bar_type:'static',front_door:'h-front',back_door:'h-back',do_remove_sel:'h-do-remove-pint',drop_shadows:!1,init:function init(){},on_bar_down:function on_bar_down(){}},this.args=Object.assign({},this.default_args,c),this.suppressed=!1,this.initiated=!1,this.organic_height=0,this.fixed_height=0,this.bars=[],this._container=document.querySelector('.'+this.args.container_sel),this._container||this.setupContainer(),this.doPushQueue(),this.setup(),window.addEventListener('scroll',this.check_fixed.bind(this));var d=!1;window.addEventListener('resize',function(){d||(b.setup(),setTimeout(function(){d=!1,clearTimeout()},200),d=!0)}),'function'==typeof this.args.init&&this.args.init(this),this.initiated=!0}return _createClass(a,[{key:'parseHTML',value:function parseHTML(a){var b=document.implementation.createHTMLDocument();return b.body.innerHTML=a,b.body.children[0]}},{key:'doPushQueue',value:function doPushQueue(){window.BKQ=function(a){if(a&&a.length)for(var b=0;b<a.length;b++)'function'==typeof a[b]&&a[b]();return{push:function push(a){'function'==typeof a&&a()}}}(window.BKQ)}},{key:'get_organic_height',value:function get_organic_height(){return this.organic_height}},{key:'get_fixed_height',value:function get_fixed_height(){return this.fixed_height}},{key:'setupContainer',value:function setupContainer(){var a=this.args,b=a.container_sel,c=a.pint_bar_class,d=void 0,e=void 0,f=void 0;d=document.createElement('div'),d.className=b,e=document.querySelector('.'+c),e?(e.parentNode.insertBefore(d,e),f=document.querySelectorAll('.'+c),f=[].slice.call(f),f.forEach(function(a){d.appendChild(a)})):document.body.insertBefore(d,document.body.firstChild),this._container=d}},{key:'setup',value:function setup(){var a=this;this.bars=[],this.fixed_height=0,this.organic_height=0;var b,c,d=this._container,e=this.args,f=e.bar_type,g=e.pint_bar_class,h=e.pint_wrap_class,i=e.pint_pos_class,j=e.do_remove_sel,k=e.inactive_class,l=e.fixed_class;b=d.querySelectorAll('.'+g)||[],b=[].slice.call(b),b.forEach(function(b){var c,d,e,f=b.parentNode,g=f.parentNode;f.classList.contains(i)&&g.classList.contains(h)||(f=document.createElement('div'),g=document.createElement('div'),f.className=i,g.className=h,b.parentNode.insertBefore(f,b),f.appendChild(b),c=b.parentNode,c.parentNode.insertBefore(g,c),g.appendChild(c),d=c.parentNode,e=c.querySelectorAll('.'+j)||[],e=[].slice.call(e),e.forEach(function(b){b.addEventListener('click',function(){a.remove(d)})}))}),c=d.querySelectorAll('.'+h)||[],c=[].slice.call(c),c.forEach(function(b,c){var d,e,h,j,l=b.querySelector('.'+i),m=b.querySelector('.'+g);return m?(b.classList.contains(k)&&b.classList.remove(k),'none'===m.style.display||'none'===getComputedStyle(m).display?void b.classList.add(k):void(j=b.getAttribute('data-pint-id'),!j&&(j=Math.random().toString(36).substr(2,12),b.setAttribute('data-pint-id',j)),d=m.getAttribute('data-type')||f,d&&b.setAttribute('data-type',d),h=m.style.height||m.offsetHeight+'px',l.style.width='100%',l.style.zIndex=(1e3-c).toString(),e={pint_id:j,type:d,fixed:!1,height:h,top:b.getBoundingClientRect().top+document.body.scrollTop,fixed_top:0,_bar:m,_pos:l,_wrap:b,priority:m.getAttribute('data-priority')||2},'fixed'===e.type&&(e.fixed_top=a.fixed_height,e._pos.style.height=e.height,e._pos.style.top=e.fixed_top+'px',a.fixed_height+=parseInt(e.height)),a.organic_height+=parseInt(e.height),a.bars.push(e),a.pick_up_or_put_down(e))):void b.parentNode.removeChild(b)})}},{key:'insert',value:function insert(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:'',b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:'top',c=2<arguments.length&&void 0!==arguments[2]&&arguments[2],d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:!0,e=4<arguments.length&&void 0!==arguments[4]&&arguments[4],f=void 0,g=this._container,h=this.suppressed,i=this.args,j=i.front_door,k=i.back_door,l=g.querySelector('.'+j),m=g.querySelector('.'+k);return(l||(l=document.createElement('div'),l.className=j,g.insertBefore(l,g.firstChild)),m||(m=document.createElement('div'),m.className=k,g.appendChild(m)),h&&d&&!e)?(console.log('Bartender: Suppresed pint insert'),!1):('string'==typeof a?f=this.parseHTML(a):'object'===('undefined'==typeof a?'undefined':_typeof(a))&&(a.length?f=a[0]:f=a),!f||f.getAttribute('data-priority')||d||f.setAttribute('data-priority',2),c?'top'===b?g.insertBefore(f,g.firstChild):g.appendChild(f):'top'===b?g.insertBefore(f,l):g.insertBefore(f,m),this.setup(),!0)}},{key:'pick_up_or_put_down',value:function pick_up_or_put_down(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=this.args,c=b.on_bar_down,d=b.fixed_class,e=b.drop_shadows,f=a._pos.querySelector('.inner'),g='0px 3px 10px rgba(0, 0, 0, 0.4)';return'static'!==a.type&&(window.scrollY+a.fixed_top>a.top?(e&&(a._pos.style.boxShadow=g),a._wrap.classList.add(d),a._pos.style.position='fixed',a.fixed=!0):(e&&(a._pos.style.boxShadow=g),a._pos.style.position='static',a._wrap.classList.remove(d),a.fixed=!1,'function'==typeof c&&c(a)),!0)}},{key:'check_fixed',value:function check_fixed(){var a=this,b=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return(b||window.scrollY<=this.organic_height+80)&&this.bars.forEach(function(b){a.pick_up_or_put_down(b)}),!0}},{key:'remove',value:function remove(a){if(!a)return!1;for(var b=a.getAttribute('data-pint-id'),c=this.bars.length;c--;)if(this.bars[c].pint_id===b){break}return'undefined'!=typeof index&&(bar=this.bars[index],bar._wrap.parentNode.removeChild(bar._wrap),'fixed'===bar.type&&bar.fixed&&(height=parseInt(bar.height),window.scrollTo(window.scrollX,window.scrollY-height)),this.setup(),!0)}},{key:'remove_expendables',value:function remove_expendables(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2,b=1<arguments.length&&void 0!==arguments[1]&&arguments[1],c=!1;return b&&(this.suppressed=!0),this.bars.forEach(function(b){b._bar.getAttribute('data-priority')||b.priority;if(b.priority>=a&&(console.log('Removed: '+b._bar.className),b._wrap.parentNode.removeChild(b._wrap),c=!0,'fixed'===b.type)){var d=parseInt(b.height);window.scrollTo(window.scrollX,window.scrollY-d)}}),this.setup(),c}}]),a}();'object'===('undefined'==typeof module?'undefined':_typeof(module))&&(module.exports=_Barkeep);